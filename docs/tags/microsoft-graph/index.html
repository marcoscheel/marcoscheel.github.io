<!DOCTYPE html>
<html lang="en">

<head>
    
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="generator" content="Hugo 0.80.0" />


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


<title>Microsoft Graph - Marco Scheel aka GeekDotNet</title>


<meta name="author" content="Marco Scheel" />


<meta name="description" content="Marco Scheel. Microsoft 365 Modern Collaboration. Podcast Co-Host of Hairless in the Cloud" />



<meta property="og:title" content="Microsoft Graph" />
<meta name="twitter:title" content="Microsoft Graph" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://marcoscheel.de/tags/microsoft-graph/" /><meta property="og:image" content="https://marcoscheel.de/og.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://marcoscheel.de/og.png" /><meta property="og:updated_time" content="2021-01-25T10:10:10+01:00" />


<style>
    @media (prefers-color-scheme: dark) {
        body[data-theme='auto'] img {
            filter: brightness(60%);
        }
    }

    body[data-theme='dark'] img {
        filter: brightness(60%);
    }
</style>



<link rel="stylesheet" href="https://marcoscheel.de/assets/css/fuji.min.css" />





<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-391088-7', {'anonymize_ip': true});
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-391088-7"></script>



<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" type="application/rss+xml" href="http://feeds.marcoscheel.de/marcoscheel">

</head>

<body data-theme="auto">
    <script data-cfasync="false">
  
  var fujiThemeData = localStorage.getItem('fuji_data-theme');
  
  if (!fujiThemeData) {
    localStorage.setItem('fuji_data-theme', 'auto');
  } else {
    
    if (fujiThemeData !== 'auto') {
      document.body.setAttribute('data-theme', fujiThemeData === 'dark' ? 'dark' : 'light');
    }
  }
</script>
    <header>
    <div class="container-lg clearfix">
        <div class="col-12 header">
            <a class="title-main" href="https://marcoscheel.de">Marco Scheel aka GeekDotNet</a>
            
            <span class="title-sub">Früher SharePoint. Heute Microsoft 365 Modern Collaboration. Co-Host of Hairless in the cloud.</span>
            
        </div>
    </div>
</header>

    <main>
        <div class="container-lg clearfix">
            
            <div class="col-12 col-md-9 float-left content">
                

<div class="page-info">
    <span>Posts with the tag Microsoft Graph: </span>
</div>



<div class="post">
    <h2 class="post-item post-title">
        <a href="https://marcoscheel.de/post/2021/01/20210124-m365teamsbackup-aadapp/">Create your Azure AD application via script - M365.TeamsBackup</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2021-01-25</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;1763 words</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href="/tags/microsoft-365">Microsoft 365</a>&nbsp;<a href="/tags/microsoft-teams">Microsoft Teams</a>&nbsp;<a href="/tags/development">Development</a>&nbsp;<a href="/tags/microsoft-graph">Microsoft Graph</a>&nbsp;<a href="/tags/azure-ad">Azure AD</a>&nbsp;</span>

    </div>
    <div class="post-item post-summary markdown-body">
        <p>If you are using Azure AD authentication for your scripts, apps, or other scenarios at some point you will end up creating your own application in your directory. Normally you open the Azure portal and navigate to the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app" target="_blank">&ldquo;App registrations&rdquo;</a> part of AAD. This is fine during development, but if you want to share the solution or a customer wants to run the software in their own tenant, things get complicated and error prone. For my Microsoft Teams backup solution this is very real because you need to hit all required permissions and configure the public client part otherwise the solution will not run.</p>
<p>This post provides you will all the needed information to create your own script. I&rsquo;m using my <a href="https://github.com/marcoscheel/M365.TeamsBackup" target="_blank">M365 Teams Backup</a> solution as a reference. The key components are:</p>
<ul>
<li>Install the Azure CLI or the Azure AD Preview PowerShell module</li>
<li>The scripts to setup the app
<ul>
<li><a href="https://github.com/marcoscheel/M365.TeamsBackup/blob/main/deploy/create-aadapp-cli.ps1" target="_blank">create-aadapp-cli.ps1</a> via Azure CLI</li>
<li>or <a href="https://github.com/marcoscheel/M365.TeamsBackup/blob/main/deploy/create-aadapp.ps1" target="_blank">create-aadapp.ps1</a> via PowerShell</li>
</ul>
</li>
</ul>
<p><img class="img-zoomable" src="/img/20210124-m365teamsbackup-aadapp--title.jpg" alt="image" />
</p>
    </div>
</div>

<div class="post">
    <h2 class="post-item post-title">
        <a href="https://marcoscheel.de/post/2020/12/20201130-m365teamsbackup/">Microsoft Teams backup your channel messages with Microsoft Graph</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2020-12-13</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;2363 words</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href="/tags/microsoft-365">Microsoft 365</a>&nbsp;<a href="/tags/microsoft-teams">Microsoft Teams</a>&nbsp;<a href="/tags/development">Development</a>&nbsp;<a href="/tags/microsoft-graph">Microsoft Graph</a>&nbsp;</span>

    </div>
    <div class="post-item post-summary markdown-body">
        <p>I have sat down for four weekends in a row to come up with a solution for two problem I encountered in the past:</p>
<ul>
<li>I wanted to save all images from a beautiful Teams channel message. Teams is saving these inline images not to SharePoint. The only way to download is to click on each image.</li>
<li>We are doing a Tenant to Tenant migration at <a href="https://glueckkanja-gab.com/en/" target="_blank">glueckkanja-gab</a> after our merger. Most of the migration tools will support the migration of Teams chat, but not all tools are available, and some implementations are lacking features for a more flexible approach.</li>
</ul>
<p>I started my career as a developer and my heart is still thinking Visual Basic. Do not be afraid, I migrated my dev skills to C# a long time ago and my array starts at 0 not 1.</p>
<p><img class="img-zoomable" src="/img/20201130-m365teamsbackup--title.png" alt="image" />
</p>
<p>I really wanted to try a few things regarding Microsoft Graph, the Microsoft Graph SDK and Microsoft Teams. The Microsoft Teamwork part of the API has a solid starting point (if you look at the beta version). The API is getting <a href="https://docs.microsoft.com/en-us/graph/teams-concept-overview" target="_blank">very mature set of capabilities</a>. I&rsquo;m a huge fan of <a href="https://azure.microsoft.com/en-us/services/functions/" target="_blank">Azure Functions</a> and I&rsquo;ve done quite a few projects that are talking to the Microsoft Graph using <a href="https://docs.microsoft.com/en-us/graph/auth/auth-concepts#microsoft-graph-permissions" target="_blank">Application Permissions</a>. I&rsquo;ve checked the documentation and if I wanted to go this route I would have to request <a href="https://docs.microsoft.com/en-us/graph/teams-protected-apis" target="_blank">special permissions</a> from Microsoft to access the content without a real user. For now I decided to go with a console application and a <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code" target="_blank">Azure AD Device Code flow</a>.</p>
<p>I have published the source code at GitHub. Maybe this will get your own solution a kickstart. Just a quick disclaimer: A lot of this stuff is first time code for me (DI in a console, Graph Auth provider, logging, &hellip;). I think at some points I over-engineered the solution and I got distracted from my real business problems ;)</p>
<p><a href="https://github.com/marcoscheel/M365.TeamsBackup">https://github.com/marcoscheel/M365.TeamsBackup</a></p>
<p>In the following sections I will show you how I approached the problem, how the result of the backup looks, how to setup and how to run it for yourself.</p>
    </div>
</div>

<div class="post">
    <h2 class="post-item post-title">
        <a href="https://marcoscheel.de/post/2019/07/186138885112-app-permissions-f%C3%BCr-microsoft-graph-calls/">App Permissions für Microsoft Graph Calls automatisiert einrichten</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2019-07-08</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;393 words</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href="/tags/microsoft-365">Microsoft 365</a>&nbsp;<a href="/tags/azure-ad">Azure AD</a>&nbsp;<a href="/tags/microsoft-graph">Microsoft Graph</a>&nbsp;<a href="/tags/development">Development</a>&nbsp;</span>

    </div>
    <div class="post-item post-summary markdown-body">
        <p>Für unser Glück &amp; Kanja Lifecycle Tool setze ich im Schwerpunkt auf Microsoft Graph Calls. Für ein sauberes Setup habe ich mittlerweile ein Script. Es nutzt die <a href="https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-2.0.0" target="_blank">PowerShell AZ</a> und die <a href="https://docs.microsoft.com/en-US/cli/azure/install-azure-cli?view=azure-cli-latest" target="_blank">Azure CLI</a>. Besonders beim Erstellen einer Azure AD App (genauer Berechtigen und Granten) ist die Azure CLI noch ein Stück besser bzw. umfangreicher als die AZ PowerShell.</p>
<p>Die Lifecycle App arbeitet mit AD Settings und Groups. Erweiterte Funktionen setzen auf <a href="https://docs.microsoft.com/en-us/azure/active-directory/governance/access-reviews-overview" target="_blank">Access Reviews</a> Feature aus dem AAD P2 Lizenzset. Diese Graph Berechtigungen setze ich direkt per CLI Script:</p>
<pre><code class="language-PowerShell">az ad app permission add --id $adapp.ApplicationId --api 00000003-0000-0000-c000-000000000000 --api-permissions 19dbc75e-c2e2-444c-a770-ec69d8559fc7=Role #msgraph Directory.ReadWrite.All
az ad app permission add --id $adapp.ApplicationId --api 00000003-0000-0000-c000-000000000000 --api-permissions 62a82d76-70ea-41e2-9197-370581804d09=Role #msgraph Group.ReadWrite.All
az ad app permission add --id $adapp.ApplicationId --api 00000003-0000-0000-c000-000000000000 --api-permissions ef5f7d5c-338f-44b0-86c3-351f46c8bb5f=Role #msgraph AccessReview.ReadWrite.All
az ad app permission add --id $adapp.ApplicationId --api 00000003-0000-0000-c000-000000000000 --api-permissions 60a901ed-09f7-4aa5-a16e-7dd3d6f9de36=Role #msgraph ProgramControl.ReadWrite.All
</code></pre>
    </div>
</div>

<div class="post">
    <h2 class="post-item post-title">
        <a href="https://marcoscheel.de/post/2019/07/185978935612-microsoft-graph-postman-und-wie-bekomme-ich-ein/">Microsoft Graph, Postman und Wie bekomme ich ein App Only Token?</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2019-07-01</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;424 words</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href="/tags/microsoft-365">Microsoft 365</a>&nbsp;<a href="/tags/azure-ad">Azure AD</a>&nbsp;<a href="/tags/microsoft-graph">Microsoft Graph</a>&nbsp;<a href="/tags/tools">Tools</a>&nbsp;</span>

    </div>
    <div class="post-item post-summary markdown-body">
        <p>Der Microsoft Graph ist das “Schweizer Taschenmesser” für alle im Microsoft 365 Umfeld. Eine API für “alle” Dienste und noch besser immer das gleiche Authentifizierungsmodel. Im <a href="https://hairlessinthecloud.com" target="_blank">Hairless in the Cloud</a> Podcast Nummer <a href="https://anchor.fm/hairlessinthecloud/episodes/018---Wir-kennen-die-Passwrter-Eurer-User-und-Microsoft-Graph-e42di4/a-aff2ff" target="_blank">18</a> habe ich meine Eindrücke zum Microsoft Graph schon geschildert. Der Graph Explorer auf der Website ist eine gute Methode den Graph kennenzulernen. Ich für meinen Teil bewege mich aber überwiegend ohne Benutzerinteraktion im Graph und somit nutze ich in meinen Anwendungen die Application Permissions. Die meisten APIs (vgl. Teams) kommen allerdings erstmal ohne App Permissions daher. Die Enttäuschung ist groß, wenn man über den Graph Explorer sein Research gemacht hat und dann feststellt, dass die Calls als App Permission scheitern.</p>
<p>Jeremy Thake aus dem Microsoft Graph Team hat vor einigen Monaten angefangen, die Samples (und mehr) aus dem <a href="https://developer.microsoft.com/en-us/graph/blogs/postman-collections/" target="_blank">Graph Explorer in einer Collection für Postman</a> zu veröffentlichen. Diese Collection vereinfacht das Testen der eigenen Calls und gibt Anregung für neue Szenarien.</p>
<p>In der Vergangenheit habe ich mir aus meiner Azure Function das Token “geklaut” und dann im Postman als Bearer Token direkt hinterlegt:
<img class="img-zoomable" src="/tmblr/cd/ef/cad14ee0d8e93c6d3b12f08d7601.png" alt="image" />
</p>
    </div>
</div>










            </div>
            <aside class="col-12 col-md-3 float-left sidebar">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives/">Archives</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
            <li>
                <a href="/search/">Search</a>
            </li>
            
            <li>
                <a href="/impressum/">Impressum</a>
            </li>
            
            <li>
                <a href="http://feeds.marcoscheel.de/marcoscheel">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
            <li>
                <a href="https://github.com/marcoscheel" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://twitter.com/marcoscheel" target="_blank"><span>Twitter</span></a>
            </li>
            
            <li>
                <a href="https://www.linkedin.com/in/marcoscheel" target="_blank"><span>LinkedIn</span></a>
            </li>
            
            <li>
                <a href="https://hairlessinthecloud.com" target="_blank"><span>Hairless in the cloud</span></a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
            <span>
                <a href="/tags/azure-ad/">Azure AD</a>
            </span>
            
            <span>
                <a href="/tags/development/">Development</a>
            </span>
            
            <span>
                <a href="/tags/equipment/">Equipment</a>
            </span>
            
            <span>
                <a href="/tags/groups/">Groups</a>
            </span>
            
            <span>
                <a href="/tags/meta/">Meta</a>
            </span>
            
            <span>
                <a href="/tags/microsoft-365/">Microsoft 365</a>
            </span>
            
            <span>
                <a href="/tags/microsoft-graph/">Microsoft Graph</a>
            </span>
            
            <span>
                <a href="/tags/microsoft-teams/">Microsoft Teams</a>
            </span>
            
            <span>
                <a href="/tags/mip/">MIP</a>
            </span>
            
            <span>
                <a href="/tags/office365/">Office365</a>
            </span>
            
            <span>
                <a href="/tags/sharepoint/">SharePoint</a>
            </span>
            
            <span>
                <a href="/tags/tools/">Tools</a>
            </span>
            
            <span>
                <a href="/tags/work/">Work</a>
            </span>
            
            <span>
                <a href="/tags/xarchived/">xArchived</a>
            </span>
            
        </div>
    </div>
    <div class="sidebar-item sidebar">
        <a class="twitter-timeline" data-height="400" href="https://twitter.com/marcoscheel?ref_src=twsrc%5Etfw">Tweets by marcoscheel</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
    
    
    
</aside>
        </div>
        <div class="btn">
    <div class="btn-menu" id="btn-menu">
        <i class="iconfont icon-grid-sharp"></i>
    </div>
    <div class="btn-toggle-mode">
        <i class="iconfont icon-contrast-sharp"></i>
    </div>
    <div class="btn-scroll-top">
        <i class="iconfont icon-chevron-up-circle-sharp"></i>
    </div>
</div>
<aside class="sidebar-mobile" style="display: none;">
  <div class="sidebar-wrapper">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives/">Archives</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
            <li>
                <a href="/search/">Search</a>
            </li>
            
            <li>
                <a href="/impressum/">Impressum</a>
            </li>
            
            <li>
                <a href="http://feeds.marcoscheel.de/marcoscheel">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
            <li>
                <a href="https://github.com/marcoscheel" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://twitter.com/marcoscheel" target="_blank"><span>Twitter</span></a>
            </li>
            
            <li>
                <a href="https://www.linkedin.com/in/marcoscheel" target="_blank"><span>LinkedIn</span></a>
            </li>
            
            <li>
                <a href="https://hairlessinthecloud.com" target="_blank"><span>Hairless in the cloud</span></a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
            <span>
                <a href="/tags/azure-ad/">Azure AD</a>
            </span>
            
            <span>
                <a href="/tags/development/">Development</a>
            </span>
            
            <span>
                <a href="/tags/equipment/">Equipment</a>
            </span>
            
            <span>
                <a href="/tags/groups/">Groups</a>
            </span>
            
            <span>
                <a href="/tags/meta/">Meta</a>
            </span>
            
            <span>
                <a href="/tags/microsoft-365/">Microsoft 365</a>
            </span>
            
            <span>
                <a href="/tags/microsoft-graph/">Microsoft Graph</a>
            </span>
            
            <span>
                <a href="/tags/microsoft-teams/">Microsoft Teams</a>
            </span>
            
            <span>
                <a href="/tags/mip/">MIP</a>
            </span>
            
            <span>
                <a href="/tags/office365/">Office365</a>
            </span>
            
            <span>
                <a href="/tags/sharepoint/">SharePoint</a>
            </span>
            
            <span>
                <a href="/tags/tools/">Tools</a>
            </span>
            
            <span>
                <a href="/tags/work/">Work</a>
            </span>
            
            <span>
                <a href="/tags/xarchived/">xArchived</a>
            </span>
            
        </div>
    </div>
    
    
  </div>
</aside>
    </main>

    <footer>
    <div class="container-lg clearfix">
        <div class="col-12 footer">
            
            <span>&copy; 2021
                <a href="https://marcoscheel.de">Marco Scheel</a>
                
                | Powered by <a href="https://github.com/amzrk2/hugo-theme-fuji/"
                   target="_blank">Fuji-v2</a> &amp; <a href="https://gohugo.io/"
                                                    target="_blank">Hugo</a> 
            </span>
        </div>
    </div>
</footer>

    
<script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.0/lazysizes.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>



<script defer src="/assets/js/fuji.min.js"></script>


</body>

</html>