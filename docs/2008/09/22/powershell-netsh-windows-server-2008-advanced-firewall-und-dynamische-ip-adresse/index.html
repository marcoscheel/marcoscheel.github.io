<!DOCTYPE html>
<html lang="en">

<head>
    
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="generator" content="Hugo 0.75.1" />


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


<title>PowerShell, NETSH, Windows Server 2008 Advanced Firewall und Dynamische IP Adresse - Marco Scheel aka GeekDotNet</title>


<meta name="author" content="marcoscheel" />


<meta name="description" content="Marco Scheel. Microsoft 365 Modern Collaboration. Podcast Co-Host of Hairless in the Cloud " />


<meta name="keywords" content="xArchived" />

<meta property="og:title" content="PowerShell, NETSH, Windows Server 2008 Advanced Firewall und Dynamische IP Adresse" />
<meta property="og:description" content="Wir entwickeln gerade an einer Anwendung mit Cloud Komponenten. Wichtig… wir sind HIP… oder heißt das heute anders? In der Cloud hat den Vorteil, fast alles über HTTP(S) machen zu können. Das Arbeiten in der Cloud hat aber auch Nachteile… zum Beispiel, das es fast nur HTTP(S) gibt :-) Mir geht es hier nicht um Probleme anderer Leute, alternative Ansätze stehe nicht zur Diskussion… ich erzähle, das hier, weil ich damit gerade ein Problem hatte. Also zu den Details.
Wir haben ein Server im Internet (sucht euch ein Hoster aus und stellt euch da ein Server vor). Dieser Server wird auch zu Entwicklungszwecken genutzt, da wir die Probleme des Web 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://marcoscheel.de/2008/09/22/powershell-netsh-windows-server-2008-advanced-firewall-und-dynamische-ip-adresse/" />
<meta property="og:image" content="https://marcoscheel.de/og.png"/>
<meta property="article:published_time" content="2008-09-22T20:00:54+00:00" />
<meta property="article:modified_time" content="2008-09-22T20:00:54+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://marcoscheel.de/og.png"/>

<meta name="twitter:title" content="PowerShell, NETSH, Windows Server 2008 Advanced Firewall und Dynamische IP Adresse"/>
<meta name="twitter:description" content="Wir entwickeln gerade an einer Anwendung mit Cloud Komponenten. Wichtig… wir sind HIP… oder heißt das heute anders? In der Cloud hat den Vorteil, fast alles über HTTP(S) machen zu können. Das Arbeiten in der Cloud hat aber auch Nachteile… zum Beispiel, das es fast nur HTTP(S) gibt :-) Mir geht es hier nicht um Probleme anderer Leute, alternative Ansätze stehe nicht zur Diskussion… ich erzähle, das hier, weil ich damit gerade ein Problem hatte. Also zu den Details.
Wir haben ein Server im Internet (sucht euch ein Hoster aus und stellt euch da ein Server vor). Dieser Server wird auch zu Entwicklungszwecken genutzt, da wir die Probleme des Web 2."/>



<style>
    @media (prefers-color-scheme: dark) {
        body[data-theme='auto'] img {
            filter: brightness(60%);
        }
    }

    body[data-theme='dark'] img {
        filter: brightness(60%);
    }
</style>



<link rel="stylesheet" href="https://marcoscheel.de/assets/css/fuji.min.css" />





<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-391088-7', {'anonymize_ip': true});
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-391088-7"></script>



<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" type="application/rss+xml" href="http://feeds.marcoscheel.de/marcoscheel">

</head>

<body data-theme="auto">
    <script data-cfasync="false">
  
  var fujiThemeData = localStorage.getItem('fuji_data-theme');
  
  if (!fujiThemeData) {
    localStorage.setItem('fuji_data-theme', 'auto');
  } else {
    
    if (fujiThemeData !== 'auto') {
      document.body.setAttribute('data-theme', fujiThemeData === 'dark' ? 'dark' : 'light');
    }
  }
</script>

    <header>
    <div class="container-lg clearfix">
        <div class="col-12 header">
            <a class="title-main" href="https://marcoscheel.de">Marco Scheel aka GeekDotNet</a>
            
            <span class="title-sub">Früher SharePoint. Heute Microsoft 365 Modern Collaboration. Co-Host of Hairless in the cloud.</span>
            
        </div>
    </div>
</header>

    <main>
        <div class="container-lg clearfix">
            
            <div class="col-12 col-md-9 float-left content">
                
<article>
    
    <h2 class="post-item post-title">
        <a href="https://marcoscheel.de/2008/09/22/powershell-netsh-windows-server-2008-advanced-firewall-und-dynamische-ip-adresse/">PowerShell, NETSH, Windows Server 2008 Advanced Firewall und Dynamische IP Adresse</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2008-09-22</span><span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;613 words</span><span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href="/tags/xarchived">xArchived</a>&nbsp;</span>

    </div>
    
    
    <div class="post-content markdown-body">
        <p>Wir entwickeln gerade an einer Anwendung mit <a href="http://en.wikipedia.org/wiki/Cloud_computing" target="_blank">Cloud</a> Komponenten. Wichtig… wir sind <a href="http://en.wikipedia.org/wiki/Hip_%28slang%29" target="_blank">HIP</a>… oder heißt das heute anders? In der Cloud hat den Vorteil, fast alles über HTTP(S) machen zu können. Das Arbeiten in der Cloud hat aber auch Nachteile… zum Beispiel, das es fast nur HTTP(S) gibt :-) Mir geht es hier nicht um Probleme anderer Leute, alternative Ansätze stehe nicht zur Diskussion… ich erzähle, das hier, weil ich damit gerade ein Problem hatte. Also zu den Details.</p>
<p>Wir haben ein Server im Internet (sucht euch ein Hoster aus und stellt euch da ein Server vor). Dieser Server wird auch zu Entwicklungszwecken genutzt, da wir die Probleme des Web 2.0 von Anfang an benötigen (DNS, Cross-Site-Access, SSL Validation, etc). Der Server hat als Betriebssystem Windows Server 2008. Ein IIS7 bietet die Cloud-Dienste an und ein SQL Server 2008 steht hinter unserer Cloud für das Persistieren der Daten bereit. Mit Hilfe von Astoria (aka ADO.NET Data Services) gibt es Zugriff auf die Daten. Für das Erstellen der Zugriffsschicht (EDMX) benötigt das Visual Studio direkten Zugriff auf die SQL Datenbank. Hier liegt nun das Problem: Für Browsing ins Internet nutzten wir eine schnelle DSL Leitung mit wechselnden IP Adressen. Ich kann dern Windows Server also nicht einfach eine IP Eintragen und fertig. Für den Quickstart (und für den Quasi-Securitytest) wurde der gepatchte Server einfach auf 1433 (SQL Standard TCP Port) geöffnet. Schon nach einem Tag zeige das EventLog massiv viele Einträge über fehlerhafte SA Loginversuche. Slammer lässt also noch 2008 grüßen :-)</p>
<p>Welche Optionen gibt es in solchen Fällen?</p>
<pre><code>* Die Clients benötigen eine Statische IP Adresse                 * Für die Servernetze ist das ok, aber fürs Browsen muss das nicht sein               * Den Server ins Clientnetz holen                 * Einfach aber nicht realitätsnah               * Eine VPN Lösung einsetzen                 * Administrativer Aufwand ist zu hoch und am Client muss man immer schauen das die VPN oben ist               * Die dynamische IP Adresse am Server bekannt machen                 * Bingo… aber wie? Einfach weiter lesen.           
</code></pre>
<p>Wir mache ich also eine dynamisch DSL IP, die täglich einmal wechselt, auf dem Server bekannt? Für die ersten zwei Tage habe ich unsere IP bei <a href="http://www.wasistmeineip.de" target="_blank">http://www.wasistmeineip.de</a> nachgeschlagen und in der Firewall des SQL Server eingetragen. Funktioniert… aber ist auf dauer langweilig. Jetzt kommen die Tools aus dem Titel zum Einsatz:<a href="http://cloudfront.gkdatacenter.net/marco/WindowsLiveWriter/PowerShellNETSHWindowsServer2008Advanced_12A39/image_4.png" target="_blank"><img class="img-zoomable" src="http://cloudfront.gkdatacenter.net/marco/WindowsLiveWriter/PowerShellNETSHWindowsServer2008Advanced_12A39/image_thumb_1.png" alt="image" />

</a></p>
<pre><code>1. [Windows Server 2008 Advanced Firewall](http://www.microsoft.com/windowsserver2008/en/us/security-policy.aspx)         
</code></pre>
<p>Eine Inbound-Rule anlegen, die 1433 erlaubt.       2. <a href="http://www.windowsnetworking.com/articles_tutorials/Configure-Windows-2008-Advanced-Firewall-NETSH-CLI.html" target="_blank">NETSH</a>      <br>
Eine CommandLine, die in der Lage ist, Rules der Advanced Firewall zu modifizieren.       3. <a href="http://www.microsoft.com/windowsserver2008/en/us/server-management.aspx" target="_blank">PowerShell</a>      <br>
Die Script-Umgebung für den Zugriff auf .NET Objekte wir zum Beispiel: <a href="http://msdn.microsoft.com/en-us/library/system.net.dns.aspx" target="_blank">System.Net.DNS</a>      4. <a href="http://www.dyndns.com/" target="_blank">DynDNS</a>      <br>
Ein Dienst, der auf vielen Routern genutzt werden kann, um sein “privates” DSL Netz mit einer dynamischen IP im Netz auffindbar zu machen.       5. <a href="http://msdn.microsoft.com/en-us/library/aa383614.aspx" target="_blank">Windows Task Scheduler 2.0</a>      <br>
Kurze Zeit nach dem IP Wechsel (der ja in der Regel immer zur selben Zeit ist) wird das PowerShell los getreten, um die Firewall zu modifizieren.</p>
<p>Und so sieht das ganze aus:</p>
<pre><code>&lt;span style=&quot;color:#606060;&quot;&gt;   1:&lt;/span&gt; ipconfig /flushdns




&lt;span style=&quot;color:#606060;&quot;&gt;   2:&lt;/span&gt; $ip = [System.Net.Dns]::GetHostAddresses(&lt;span style=&quot;color:#006080;&quot;&gt;&quot;meindynamischesnetz.dyndns.org&quot;&lt;/span&gt;)[0].ToString()




&lt;span style=&quot;color:#606060;&quot;&gt;   3:&lt;/span&gt; $ip = $ip + &lt;span style=&quot;color:#006080;&quot;&gt;&quot;/255.255.255.255,192.168.1.1/255.255.255.255&quot;&lt;/span&gt;




&lt;span style=&quot;color:#606060;&quot;&gt;   4:&lt;/span&gt; netsh advfirewall firewall set rule name=&lt;span style=&quot;color:#006080;&quot;&gt;&quot;SQL-Server&quot;&lt;/span&gt; &lt;span style=&quot;color:#0000ff;&quot;&gt;new&lt;/span&gt; remoteip=$ip
</code></pre>
<p>1: FLUSHDNS für einen frischen DNS Cache</p>
<p>2: Ermitteln der ersten IP Adresse des DYNDNS Eintrags</p>
<p>3: Hinzufügen der IP mit SubNetMask zu weiteren statischen IP Adressen</p>
<p>4: Die REMOTEIP auf die Rule mit dem Namen “SQL-Server” setzen</p>
<p>Die Lösung ist beliebig erweiterbar. Zum Beispiel, die aktuelle Konfig auszulesen und die IP zu ersetzen. Für mich hat es so erst mal gereicht… und vielleicht reicht es auch für andere mit einem selben Problem. Wichtig: Die SQL-Verbindung ist da durch nicht geschützt! Eine Lösung hierfür: <a href="http://support.microsoft.com/default.aspx/kb/306724" target="_blank">Encypt=yes</a></p>
<p>Ciao Marco</p>
<p>UPDATED: 2008-09-25 – FlushDNS ins Script mit aufgenommen</p>

    </div>
</article>


<div class="license markdown-body">
    <blockquote>
        <p>Unless otherwise noted, the content of this site is licensed under <a rel="license" href="https://creativecommons.org/licenses/by/4.0/"
               target="_blank">CC BY 4.0</a>.</p>
    </blockquote>
</div>


<div class="post-comment" data-comment="disqus">
    <span class="post-comment-notloaded">
        <i class="iconfont icon-chatbox-ellipses-sharp"></i>&nbsp;Load comments
    </span>
    <div id="disqus_thread" style="display: none;"></div>
    <script>
        function loadComment() {
            var commentArea = document.querySelector('.post-comment');
            var disqus_config = function () {
                this.page.url = 'https:\/\/marcoscheel.de\/2008\/09\/22\/powershell-netsh-windows-server-2008-advanced-firewall-und-dynamische-ip-adresse\/';
                this.page.identifier = '2008-09-22-powershell-netsh-windows-server-2008-advanced-firewall-und-dynamische-ip-adresse';
            };
            var s = document.createElement('script');
            s.src = 'https://' + 'marcoscheelof' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            document.querySelector('#disqus_thread').removeAttribute('style');
            (document.body || document.head).appendChild(s);
            document.querySelector('span.post-comment-notloaded').setAttribute('style', 'display: none;');
        }
    </script>
</div>


            </div>
            <aside class="col-12 col-md-3 float-left sidebar">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives/">Archives</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
            <li>
                <a href="/search/">Search</a>
            </li>
            
            <li>
                <a href="/impressum/">Impressum</a>
            </li>
            
            <li>
                <a href="http://feeds.marcoscheel.de/marcoscheel">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
            <li>
                <a href="https://github.com/marcoscheel" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://twitter.com/marcoscheel" target="_blank"><span>Twitter</span></a>
            </li>
            
            <li>
                <a href="https://www.linkedin.com/in/marcoscheel" target="_blank"><span>LinkedIn</span></a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
            <span>
                <a href="/tags/azuread/">AzureAD</a>
            </span>
            
            <span>
                <a href="/tags/development/">Development</a>
            </span>
            
            <span>
                <a href="/tags/equipment/">Equipment</a>
            </span>
            
            <span>
                <a href="/tags/groups/">Groups</a>
            </span>
            
            <span>
                <a href="/tags/meta/">Meta</a>
            </span>
            
            <span>
                <a href="/tags/microsoft365/">Microsoft365</a>
            </span>
            
            <span>
                <a href="/tags/microsoftgraph/">MicrosoftGraph</a>
            </span>
            
            <span>
                <a href="/tags/mip/">MIP</a>
            </span>
            
            <span>
                <a href="/tags/office365/">Office365</a>
            </span>
            
            <span>
                <a href="/tags/sharepoint/">SharePoint</a>
            </span>
            
            <span>
                <a href="/tags/teams/">Teams</a>
            </span>
            
            <span>
                <a href="/tags/tools/">Tools</a>
            </span>
            
            <span>
                <a href="/tags/work/">Work</a>
            </span>
            
            <span>
                <a href="/tags/xarchived/">xArchived</a>
            </span>
            
        </div>
    </div>
    
    
    
    <div class="sidebar-item sidebar-toc">
        <h3>TOC</h3>
        <nav id="TableOfContents"></nav>
    </div>
    
    
</aside>
        </div>
        <div class="btn">
    <div class="btn-menu" id="btn-menu">
        <i class="iconfont icon-grid-sharp"></i>
    </div>
    <div class="btn-toggle-mode">
        <i class="iconfont icon-contrast-sharp"></i>
    </div>
    <div class="btn-scroll-top">
        <i class="iconfont icon-chevron-up-circle-sharp"></i>
    </div>
</div>
<aside class="sidebar-mobile" style="display: none;">
  <div class="sidebar-wrapper">
    
    <div class="sidebar-item sidebar-pages">
        <h3>Pages</h3>
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/archives/">Archives</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
            <li>
                <a href="/search/">Search</a>
            </li>
            
            <li>
                <a href="/impressum/">Impressum</a>
            </li>
            
            <li>
                <a href="http://feeds.marcoscheel.de/marcoscheel">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>Links</h3>
        <ul>
            
            <li>
                <a href="https://github.com/marcoscheel" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://twitter.com/marcoscheel" target="_blank"><span>Twitter</span></a>
            </li>
            
            <li>
                <a href="https://www.linkedin.com/in/marcoscheel" target="_blank"><span>LinkedIn</span></a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>Tags</h3>
        <div>
            
            <span>
                <a href="/tags/azuread/">AzureAD</a>
            </span>
            
            <span>
                <a href="/tags/development/">Development</a>
            </span>
            
            <span>
                <a href="/tags/equipment/">Equipment</a>
            </span>
            
            <span>
                <a href="/tags/groups/">Groups</a>
            </span>
            
            <span>
                <a href="/tags/meta/">Meta</a>
            </span>
            
            <span>
                <a href="/tags/microsoft365/">Microsoft365</a>
            </span>
            
            <span>
                <a href="/tags/microsoftgraph/">MicrosoftGraph</a>
            </span>
            
            <span>
                <a href="/tags/mip/">MIP</a>
            </span>
            
            <span>
                <a href="/tags/office365/">Office365</a>
            </span>
            
            <span>
                <a href="/tags/sharepoint/">SharePoint</a>
            </span>
            
            <span>
                <a href="/tags/teams/">Teams</a>
            </span>
            
            <span>
                <a href="/tags/tools/">Tools</a>
            </span>
            
            <span>
                <a href="/tags/work/">Work</a>
            </span>
            
            <span>
                <a href="/tags/xarchived/">xArchived</a>
            </span>
            
        </div>
    </div>
    
    
    
    <div class="sidebar-item sidebar-toc">
        <h3>TOC</h3>
        <nav id="TableOfContents"></nav>
    </div>
    
    
  </div>
</aside>
    </main>

    <footer>
    <div class="container-lg clearfix">
        <div class="col-12 footer">
            <span>&copy; 2020 <a href="https://marcoscheel.de">Marco Scheel</a> |
                Powered by <a href="https://github.com/amzrk2/hugo-theme-fuji/"
                   target="_blank">Fuji-v2</a> & <a href="https://gohugo.io/"
                   target="_blank">Hugo</a> </span>
        </div>
    </div>
</footer>
    
<script defer src="https://cdn.jsdelivr.net/combine/npm/medium-zoom@1.0.6,npm/lazysizes@5.2.2"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/components/prism-core.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/plugins/autoloader/prism-autoloader.min.js"></script>



<script defer src="/assets/js/fuji.min.js"></script>


</body>

</html>